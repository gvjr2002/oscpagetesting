<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DemoCommerce — Fully Functional SPA</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f4f6f8; }
    header { background:#fff; padding:12px 18px; display:flex; align-items:center; gap:16px; border-bottom:1px solid #ddd; position:sticky; top:0; }
    header h1 { font-size:18px; margin:0; }
    header input { flex:1; padding:8px; border-radius:6px; border:1px solid #ccc; }
    header button { padding:8px 12px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer; }
    main { max-width:1100px; margin:20px auto; padding:0 16px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:16px; }
    .card { background:#fff; border-radius:8px; padding:12px; border:1px solid #e3e3e3; display:flex; flex-direction:column; }
    .card img { width:100%; height:150px; object-fit:cover; border-radius:6px; }
    .card h3 { font-size:15px; margin:8px 0; }
    .price { font-weight:bold; color:#ff6f00; margin-top:auto; }
    .btn { margin-top:8px; padding:8px; border:none; border-radius:6px; cursor:pointer; }
    .primary { background:#ff6f00; color:#fff; }
    .page { display:none; }
    .page.active { display:block; }
    .cart-row { display:flex; gap:12px; border-bottom:1px dashed #ddd; padding:8px 0; align-items:center; }
    footer { text-align:center; padding:20px; font-size:13px; color:#666; }
  </style>
</head>
<body>

<header>
  <h1>DemoCommerce</h1>
  <input id="search" placeholder="Search products" />
  <button onclick="goHome()">Home</button>
  <button onclick="goCart()">Cart (<span id="cartCount">0</span>)</button>
</header>

<main>
  <!-- PRODUCT LIST -->
  <section id="page-products" class="page active">
    <div class="grid" id="productGrid"></div>
  </section>

  <!-- PRODUCT DETAIL -->
  <section id="page-product" class="page"></section>

  <!-- CART -->
  <section id="page-cart" class="page"></section>

  <!-- CHECKOUT -->
  <section id="page-checkout" class="page"></section>
</main>

<footer>DemoCommerce — Full SPA ecommerce test harness</footer>

<script>
/* ---------------- DATA ---------------- */
const PRODUCTS = [
  {id:1,title:"Headphones",price:99,desc:"Noise cancelling",img:"https://picsum.photos/id/180/400/300"},
  {id:2,title:"Smartphone",price:699,desc:"Flagship phone",img:"https://picsum.photos/id/1/400/300"},
  {id:3,title:"Shoes",price:79,desc:"Running shoes",img:"https://picsum.photos/id/21/400/300"},
  {id:4,title:"Blender",price:59,desc:"Kitchen blender",img:"https://picsum.photos/id/1080/400/300"}
];

let state = {
  products: PRODUCTS,
  cart: JSON.parse(localStorage.getItem('cart')||'[]'),
  current:null
};

/* ---------------- UTIL ---------------- */
function $(id){ return document.getElementById(id); }
function show(page){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); $(page).classList.add('active'); }
function save(){ localStorage.setItem('cart', JSON.stringify(state.cart)); updateCartCount(); }

/* ---------------- RENDER ---------------- */
function renderProducts(list){
  const g = $('productGrid'); g.innerHTML='';
  list.forEach(p=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML = `
      <img src="${p.img}">
      <h3>${p.title}</h3>
      <div>${p.desc}</div>
      <div class="price">$${p.price}</div>
      <button class="btn" onclick="viewProduct(${p.id})">View</button>
      <button class="btn primary" onclick="addToCart(${p.id})">Add to Cart</button>
    `;
    g.appendChild(d);
  });
}

function renderProduct(id){
  const p = state.products.find(x=>x.id===id);
  if(!p) return goHome();
  const el = $('page-product');
  el.innerHTML = `
    <button onclick="goHome()">← Back</button>
    <h2>${p.title}</h2>
    <img src="${p.img}" style="max-width:400px;width:100%">
    <p>${p.desc}</p>
    <strong>$${p.price}</strong><br>
    <button class="btn primary" onclick="addToCart(${p.id})">Add to Cart</button>
  `;
  show('page-product');
}

function renderCart(){
  const el = $('page-cart');
  if(state.cart.length===0){ el.innerHTML='<h2>Cart empty</h2>'; return; }
  let total=0;
  el.innerHTML='<h2>Your Cart</h2>';
  state.cart.forEach(i=>{
    total+=i.qty*i.price;
    const r=document.createElement('div'); r.className='cart-row';
    r.innerHTML=`
      <div style="flex:1">${i.title} x ${i.qty}</div>
      <div>$${(i.qty*i.price).toFixed(2)}</div>
      <button onclick="removeFromCart(${i.id})">Remove</button>
    `;
    el.appendChild(r);
  });
  el.innerHTML+=`<h3>Total: $${total.toFixed(2)}</h3><button onclick="goCheckout()">Checkout</button>`;
}

function renderCheckout(){
  const el=$('page-checkout');
  el.innerHTML=`
    <h2>Checkout</h2>
    <form onsubmit="placeOrder(event)">
      <input required placeholder="Name"><br><br>
      <input required placeholder="Address"><br><br>
      <button class="btn primary">Place Order</button>
    </form>
  `;
}

/* ---------------- ACTIONS ---------------- */
function addToCart(id){
  const p=state.products.find(x=>x.id===id);
  let it=state.cart.find(x=>x.id===id);
  if(it) it.qty++; else state.cart.push({id:p.id,title:p.title,price:p.price,qty:1});
  save(); alert('Added to cart');
}
function removeFromCart(id){ state.cart=state.cart.filter(x=>x.id!==id); save(); renderCart(); }
function placeOrder(e){ e.preventDefault(); alert('Order placed successfully'); state.cart=[]; save(); goHome(); }

/* ---------------- NAV ---------------- */
function goHome(){ location.hash=''; show('page-products'); renderProducts(state.products); }
function goCart(){ location.hash='cart'; show('page-cart'); renderCart(); }
function goCheckout(){ location.hash='checkout'; show('page-checkout'); renderCheckout(); }
function viewProduct(id){ location.hash='product-'+id; renderProduct(id); }

function updateCartCount(){ $('cartCount').innerText = state.cart.reduce((s,i)=>s+i.qty,0); }

/* ---------------- ROUTER ---------------- */
window.addEventListener('load',()=>{
  updateCartCount();
  renderProducts(state.products);
  handleRoute();
});
window.addEventListener('hashchange',handleRoute);
function handleRoute(){
  const h=location.hash.replace('#','');
  if(!h) return goHome();
  if(h==='cart') return goCart();
  if(h==='checkout') return goCheckout();
  if(h.startsWith('product-')) return renderProduct(Number(h.split('-')[1]));
}
</script>
</body>
</html>
